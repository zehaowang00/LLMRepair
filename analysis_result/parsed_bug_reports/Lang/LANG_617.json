[
    {
        "title": "[LANG-617] StringEscapeUtils.escapeXML() can't process UTF-16 supplementary characters",
        "description": "<p>Supplementary characters in UTF-16 are those whose code points are above 0xffff, that is, require more than 1 Java char to be encoded, as explained here: <a href=\"http://java.sun.com/developer/technicalArticles/Intl/Supplementary/\" class=\"external-link\" target=\"_blank\" rel=\"nofollow noopener\">http://java.sun.com/developer/technicalArticles/Intl/Supplementary/</a></p>\n\n<p>Currently, StringEscapeUtils.escapeXML() isn't aware of this coding scheme and treats each char as one character, which is not always right.</p>\n\n<p>A possible solution in class Entities would be:</p>\n\n<p>    public void escape(Writer writer, String str) throws IOException {<br/>\n        int len = str.length();<br/>\n        for (int i = 0; i &lt; len; i++) {<br/>\n            int code = str.codePointAt<img class=\"emoticon\" src=\"https://issues.apache.org/jira/images/icons/emoticons/information.png\" height=\"16\" width=\"16\" align=\"absmiddle\" alt=\"\" border=\"0\"/>;<br/>\n            String entityName = this.entityName(code);<br/>\n            if (entityName != null) </p>\n{\n                writer.write('&amp;');\n                writer.write(entityName);\n                writer.write(';');\n            }\n<p> else if (code &gt; 0x7F) </p>\n{\n                    writer.write(\"&amp;#\");\n                    writer.write(code);\n                    writer.write(';');\n            }\n<p> else </p>\n{\n                    writer.write((char) code);\n            }\n\n<p>            if (code &gt; 0xffff) </p>\n{\n                    i++;\n            }\n<p>        }<br/>\n    }</p>\n\n<p>Besides fixing escapeXML(), this will also affect HTML escaping functions. I guess that's a good thing, but please remember I have only tested escapeXML().</p>"
    }
]